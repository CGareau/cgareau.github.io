I"	×<p><img src="/recommendations/Best_practice.png" alt="Best_Practice" /></p>

<h1 id="introduction">Introduction</h1>

<p>Voici quelques prÃ©conisations et bonnes pratiques, pleines de bon sens, Ã  suivre lorsque vous dÃ©ployez des applications 4D, agrÃ©mentÃ©es dâ€™informations techniques.</p>

<h1 id="applications-4d">Applications 4D</h1>

<p><strong><em>RecommandÃ© :</em></strong></p>

<ul>
  <li>
    <p>Utiliser le mode Unicode</p>
  </li>
  <li>
    <p>Utiliser une version 64 bits</p>
  </li>
  <li>DÃ©ployer une application 4D compilÃ©e ou exÃ©cutable en prenant soin de cocher au prÃ©alable, dans les propriÃ©tÃ©s de votre base de donnÃ©es, de :
    <ul>
      <li>cocher Â« ContrÃ´le dâ€™exÃ©cution Â»</li>
      <li>cocher Â« GÃ©nÃ©rer le fichier de symboles Â»</li>
      <li>cocher Â« GÃ©nÃ©rer le fichier dâ€™erreur Â»</li>
      <li>cocher Â« Compilation multi-cible (32 bits et 64 bits) Â»</li>
      <li>sÃ©lectionner Â« Toutes les variables sont typÃ©es Â» pour le chemin de compilation</li>
      <li>sÃ©lectionner Â« Entier long Â» pour les numÃ©riques</li>
      <li>sÃ©lectionner Â« Entier long Â» pour les boutons</li>
    </ul>
  </li>
  <li>
    <p>Utiliser des champs UUID pour les clÃ©s primaires</p>
  </li>
  <li>
    <p>Dessiner les liens entre les tables</p>
  </li>
  <li>
    <p>Ne plus utiliser la commande Â« MODIFIER SELECTION Â»</p>
  </li>
  <li>
    <p>Utiliser les objets</p>
  </li>
  <li>
    <p>Utiliser des listbox pour les listes</p>
  </li>
  <li>
    <p>Utiliser exclusivement des noms dâ€™objets</p>
  </li>
  <li>Dans lâ€™onglet Â« CompatibilitÃ© Â» des propriÃ©tÃ©s de votre base de donnÃ©es convertie (issue dâ€™une version prÃ©cÃ©dente de 4D), cocher les options :
    <ul>
      <li>Â« ExÃ©cuter CHERCHER PAR FORMULE Â» sur le serveur et Â« ExÃ©cuter TRIER PAR FORMULE sur le serveur Â»</li>
      <li>CHERCHER PAR FORMULE utilise jointures SQL Â»</li>
    </ul>
  </li>
</ul>

<h1 id="numÃ©ros-de-port">NumÃ©ros de port</h1>

<p><strong><em>RecommandÃ© :</em></strong> sâ€™assurer que les ports ci-dessous soient disponibles et dÃ©diÃ©s Ã  lâ€™application 4D Server</p>

<ul>
  <li>ports obligatoires :
    <ul>
      <li>port de publication client/serveur (modifiable dans les propriÃ©tÃ©s de la base, par dÃ©faut 19813)</li>
      <li>port applicatif (non modifiable : port de publication +1, par dÃ©faut 19814)</li>
      <li>port pour le serveur SQL (modifiable dans les propriÃ©tÃ©s de la base, par dÃ©faut 19812 ; mÃªme si vous nâ€™utilisez pas le langage SQL, 4D vÃ©rifiera au dÃ©marrage si ce port est libre)</li>
    </ul>
  </li>
  <li>ports facultatifs :
    <ul>
      <li>ports pour le serveur Web, utilisÃ©s pour les requÃªtes Web, SOAP ou REST (modifiables dans les propriÃ©tÃ©s de la base, par dÃ©faut 80 (HTTP) et 443 (HTTPS))</li>
      <li>port pour lâ€™interprÃ©teur PHP (modifiable dans les propriÃ©tÃ©s de la base, par dÃ©faut 8002 sur lâ€™adresse 127.0.0.1)</li>
      <li>dâ€™autres ports peuvent Ã©galement Ãªtre utilisÃ©s par 4D, notamment par le plugin 4D Internet Commands</li>
    </ul>
  </li>
</ul>

<p>Vous pouvez modifier les ports utilisÃ©s par 4D, par dÃ©faut. Cependant attention certains ports sont utilisÃ©s ou rÃ©servÃ©s pour dâ€™autres applications :</p>

<ul>
  <li>0 Ã  1023 (Ports rÃ©servÃ©s) : Ces ports sont affectÃ©s par lâ€™I.A.N.A. (Internet Assigned Numbers Authority) et sur la plupart des systÃ¨mes ne peuvent Ãªtre utilisÃ©s que par des process systÃ¨me (ou racine) ou par des programmes exÃ©cutÃ©s par des utilisateurs disposant de privilÃ¨ges dâ€™accÃ¨s avancÃ©s.
    <ul>
      <li>20 et 21 FTP;</li>
      <li>23 TELNET;</li>
      <li>25 SMTP;</li>
      <li>37 NTP;</li>
      <li>80 et 8080 HTTP;</li>
      <li>443 HTTPS.</li>
    </ul>
  </li>
  <li>
    <p>1024 Ã  49151 (Ports enregistrÃ©s) : Ces ports sont enregistrÃ©s par lâ€™I.A.N.A. et peuvent Ãªtre utilisÃ©s sur la plupart des systÃ¨mes par des process utilisateurs ou par des programmes exÃ©cutÃ©s par des utilisateurs sans privilÃ¨ges particuliers (routeurs, applications spÃ©cifiquesâ€¦)</p>
  </li>
  <li>49152 Ã  65535 (Ports dynamiques et/ou privÃ©s) : Ces ports sont dâ€™utilisation libre.</li>
</ul>

<p>Les personnes souhaitant utiliser les commandes TCP/IP pour synchroniser des bases de donnÃ©es doivent utiliser des numÃ©ros de port supÃ©rieurs Ã  49151.</p>

<p>Pour de plus amples informations, veuillez visiter le <a href="http://www.iana.org">site Web de lâ€™I.A.N.A.</a></p>

<h1 id="processeur">Processeur</h1>

<p><strong><em>RecommandÃ© :</em></strong></p>

<ul>
  <li>
    <p>pour les postes de travail : 1 CPU avec 2 cÅ“urs minimum</p>
  </li>
  <li>
    <p>pour les serveurs : 1 CPU avec 4 cÅ“urs minimum (plutÃ´t que 2 CPU avec 2 cÅ“urs car la mÃ©moire cache sera partagÃ©e entre tous les cÅ“urs)</p>
  </li>
  <li>
    <p>utiliser le mode prÃ©emptif pour tirer intÃ©gralement parti des machines multi-cÅ“urs (disponible Ã  partir de la version 4D v15 R5 - exÃ©cutÃ© en compilÃ© 64 bits uniquement)</p>
  </li>
  <li>
    <p>dÃ©clarer explicitement toutes les mÃ©thodes que vous souhaitez dÃ©marrer en mode prÃ©emptif (cocher lâ€™option dans les propriÃ©tÃ©s de vos mÃ©thodes et vÃ©rifier leur Ã©ligibilitÃ© grÃ¢ce au compilateur)</p>
  </li>
</ul>

<p>Depuis la version 4D v11 SQL, 4D tire partie Ã  travers le systÃ¨me des multiples cÅ“urs <em>(*)</em>. En effet, le systÃ¨me dâ€™exploitation rÃ©partit le Â« temps processeur Â» (total du temps de tous les cÅ“urs) entre chaque application et entre les threads de chaque application. Câ€™est ensuite lâ€™application qui dÃ©finit les prioritÃ©s de chacun de ses threads, chaque thread travaillant individuellement.</p>

<p><em>(*) : Les systÃ¨mes supportant le multi-threading permettent de simuler 2 cÅ“urs logiques pour chaque cÅ“ur, multipliant ainsi par deux la capacitÃ© de traitement de 4D Server.</em></p>

<p>Dans 4D, il existe des threads coopÃ©ratifs et des threads prÃ©emptifs. 4D les utilise automatiquement (pas de logiciel ou de prÃ©fÃ©rence spÃ©cifique) en fonction du code 4D exÃ©cutÃ©.</p>

<p>Tous les threads coopÃ©ratifs fonctionnent dans le thread principal Ã  la diffÃ©rence des threads prÃ©emptifs qui sont dispatchÃ©s par le serveur 4D sur les autres threads. En effet, lorsquâ€™il est exÃ©cutÃ© en mode prÃ©emptif, un process est dÃ©diÃ© Ã  un CPU (processeur). La gestion du process est alors dÃ©lÃ©guÃ©e au systÃ¨me, qui peut allouer chaque CPU sÃ©parÃ©ment sur une machine multi-coeurs.</p>

<p>Lorsquâ€™ils sont exÃ©cutÃ©s en mode coopÃ©ratif (seul mode disponible dans 4D jusquâ€™Ã  4D v15 R5), tous les process sont gÃ©rÃ©s par le thread (process systÃ¨me) de lâ€™application parente et partagent le mÃªme CPU, mÃªme sur une machine multi-coeurs.</p>

<p>Par consÃ©quent, en mode prÃ©emptif, les performances globales de lâ€™application sont amÃ©liorÃ©es, particuliÃ¨rement avec des machines multi-coeurs, car de multiples threads peuvent vÃ©ritablement Ãªtre exÃ©cutÃ©s simultanÃ©ment. Les gains effectifs dÃ©pendent cependant de la nature des opÃ©rations exÃ©cutÃ©es. Fondamentalement, le code destinÃ© Ã  Ãªtre exÃ©cutÃ© dans des threads prÃ©emptifs ne peut pas appeler dâ€™Ã©lÃ©ments ayant des interactions extÃ©rieures telles que du code de plug-in ou des variables interprocess. Lâ€™accÃ¨s aux donnÃ©es, cependant, est possible car le serveur de donnÃ©es de 4D prend en charge lâ€™exÃ©cution en mode prÃ©emptif.</p>

<p>En contrepartie, puisquâ€™en mode prÃ©emptif chaque thread est indÃ©pendant des autres et non gÃ©rÃ© directement par lâ€™application, des conditions spÃ©cifiques sont Ã  respecter dans les mÃ©thodes qui doivent Ãªtre exÃ©cutÃ©es en prÃ©emptif. De plus, le mode prÃ©emptif est disponible uniquement dans certains contextes.</p>

<p><code class="highlighter-rouge">Notes :</code></p>

<ul>
  <li>
    <p><em>Un nouveau type de process, appelÃ© process Worker, vous permet dâ€™Ã©changer des donnÃ©es entre nâ€™importe quel process, y compris des process prÃ©emptifs.</em></p>
  </li>
  <li>
    <p><em>La nouvelle commande Â« APPELER FORMULAIRE Â» fournit une solution Ã©lÃ©gante permettant dâ€™appeler des objets dâ€™interface depuis un process prÃ©emptif.</em></p>
  </li>
  <li>
    <p><em>Bien quâ€™elles aient Ã©tÃ© conÃ§ues principalement pour les besoins liÃ©s Ã  la communication interprocess dans le contexte des process prÃ©emptifs (accessibles en version 64 bits uniquement), les commandes Â« APPELER WORKER Â» et Â« APPELER FORMULAIRE Â» sont disponibles dans les versions 32 bits et peuvent Ãªtre utilisÃ©es avec des process en mode coopÃ©ratif.</em></p>
  </li>
</ul>

<p>Il faut savoir aussi quâ€™un process non local de 4D Distant communique toujours avec deux threads jumeaux sur le serveur : un thread prÃ©emptif pour les requÃªtes DB4D (crÃ©er, stocker, charger, supprimer, trier, chercher, etc.) et un thread coopÃ©ratif pour les requÃªtes applicatives (Â« date du jour(*) Â», Â« lire variable process (-1;..) Â», etc.). Un troisiÃ¨me thread prÃ©emptif peut aussi Ãªtre crÃ©Ã© si vous exÃ©cutez des commandes SQL (Ã  lâ€™appel Ã  la commande Â« Debut SQL Â»).</p>

<p>En fonction de la commande exÃ©cutÃ©e, 4D utilise tel ou tel thread en Ã©tablissant la communication sur le port correspondant :</p>

<ul>
  <li>
    <p>port de publication pour les requÃªtes DB4D (thread coopÃ©ratif)</p>
  </li>
  <li>
    <p>port applicatif (port de publication +1) pour les requÃªtes applicatives (thread prÃ©emptif)</p>
  </li>
  <li>
    <p>port SQL pour les requÃªtes SQL (thread prÃ©emptif)</p>
  </li>
</ul>

<p>En conclusion, il est trÃ¨s fortement recommandÃ© dâ€™avoir un processeur multi-cÅ“urs mÃªme si lâ€™utilisation de tous les cÅ“urs dÃ©pendra des commandes 4D utilisÃ©es dans votre application en sachant que plus vous Ãªtes prÃ©emptif, plus vous serez rapide sur une machine multi-cÅ“urs.</p>

<p><code class="highlighter-rouge">Important :</code> <em>si votre application 4D a Ã©tÃ© crÃ©Ã©e avec une trÃ¨s ancienne version de 4D, il est possible quâ€™une zone Â« PrioritÃ©s CPU Â» soit visible dans lâ€™onglet Â« GÃ©nÃ©ral Â» des propriÃ©tÃ©s de votre base de donnÃ©es. Ce paramÃ©trage est dÃ©sormais obsolÃ¨te. Lorsque la zone est affichÃ©e, il est recommandÃ© de cliquer sur le bouton Â« RÃ©glages dâ€™usine Â» afin de rÃ©initialiser les paramÃ¨tres et de les supprimer de la boÃ®te de dialogue.</em></p>

<h1 id="systÃ¨me-dexploitation">SystÃ¨me dâ€™exploitation</h1>

<p><strong><em>RecommandÃ© :</em></strong> OS 64 bits et certifiÃ© par 4D</p>

<p><code class="highlighter-rouge">Important :</code> <em>DÃ©ployer les applications 4D sur des systÃ¨mes dâ€™exploitation certifiÃ©s par notre dÃ©partement QualitÃ©. Les prÃ©-requis logiciel et systÃ¨me sont disponibles sur <a href="https://fr.4d.com/resources/4d-v18-lts">notre site web</a>.</em></p>

<ul>
  <li>
    <p>Sous Windows :</p>

    <ul>
      <li>
        <p>Pour dÃ©ployer lâ€™application 4D sur des postes de travail : Windows 10 ;</p>

        <ul>
          <li>Pour dÃ©ployer lâ€™application 4D Server sur un serveur ou lâ€™application 4D sur un serveur dâ€™applications :
            <ul>
              <li>Windows Server 2016,</li>
              <li>Windows Server 2019 ;</li>
            </ul>
          </li>
          <li>
            <p>DÃ©ployer lâ€™application 4D Server sur une machine dÃ©diÃ©e (sous Windows Server, dÃ©sactiver tous les rÃ´les, notamment le rÃ´le serveur de fichiers installÃ© par dÃ©faut) ;</p>
          </li>
          <li>DÃ©ployer la gamme 64 bits :
            <ul>
              <li>4D Server est disponible en version 64 bits Ã  partir de la version v12,</li>
              <li>4D est disponible en version 64 bits Ã  partir de la version v16 (en version Preview en 16.0 puis dans les versions 16 Rx) ;</li>
            </ul>
          </li>
          <li>
            <p>Pour des raisons de performances, nous vous invitons Ã©galement Ã  dÃ©sactiver la stratÃ©gie de sÃ©curitÃ© locale â€œClient rÃ©seau Microsoft : communications signÃ©es numÃ©riques (lorsque le serveur lâ€™accepte)â€ dans les options de sÃ©curitÃ©, qui diminue de 15% les performances lorsquâ€™elle est active ;</p>
          </li>
          <li>Les paramÃ¨tres par dÃ©faut des ordinateurs sous Windows et Windows Server sont optimisÃ©s pour Ã©conomiser lâ€™Ã©nergie. Il sâ€™agit du meilleur rÃ©glage pour une utilisation bureau. Cependant un rÃ©glage sur Â« performances Ã©levÃ©es Â» pour les serveurs permet dâ€™obtenir des performances jusquâ€™Ã  deux fois supÃ©rieures au mode Â« normal Â».</li>
        </ul>
      </li>
    </ul>

    <p>Sous Mac :</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  Pour dÃ©ployer les applications 4D ou 4D Server :
              macOS High Sierra (10.13),
              macOS Mojave (10.14) ;

  DÃ©ployer la gamme 64 bits :
              4D Server est disponible en version 64 bits Ã  partir de la version v15,
              4D est disponible en version 64 bits Ã  partir de la version v16.
</code></pre></div>    </div>

    <p>RÃ©solution dâ€™Ã©cran :</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  Les dialogues en 4D, tel que lâ€™Ã©diteur de recherches, nÃ©cessitent une rÃ©solution dâ€™Ã©cran minimale de 1280 x 1024 pixels ;

  Selon le code de l'application 4D utilisÃ©, les applications peuvent demander des rÃ©solutions plus petites (par exemple pour les appareils mobiles) ou plus grandes (par exemple, les grands Ã©crans et les Ã©crans Ã  haute rÃ©solution).
</code></pre></div>    </div>
  </li>
</ul>

<p>Les versions 64 bits permettent aux applications 4D monopostes ainsi quâ€™aux applications 4D distantes de tirer pleinement parti des systÃ¨mes dâ€™exploitation 64 bits. Le principal avantage de lâ€™architecture 64 bits est quâ€™une mÃ©moire de taille plus importante peut Ãªtre adressÃ©e.</p>

<p>Bien que largement rÃ©Ã©crites, les applications 4D 64 bits sont hautement compatibles avec les bases 4D courantes. Toutefois, Ã©tant donnÃ© quâ€™elles utilisent les technologies les plus rÃ©centes, nous avons dÃ» mettre Ã  jour quelques fonctions, et en arrÃªter dâ€™autres.</p>

<p>Dâ€™un autre cÃ´tÃ©, lâ€™implÃ©mentation de lâ€™architecture 64 bits nous a donnÃ© lâ€™opportunitÃ© de prendre en charge des fonctionnalitÃ©s puissantes comme les process 4D prÃ©emptifs (multithread), de moderniser les impressions ainsi que les dâ€™Ã©diteurs dâ€™Ã©tats rapides et dâ€™Ã©tiquettes, ou encore de faire bÃ©nÃ©ficier vos applications des animations dâ€™objets natives (4D 64 bits sous OS X).</p>

<ol>
  <li>MÃ©moire</li>
</ol>

<p>RecommandÃ© :</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pour les postes de travail : 8 Go minimum

pour les serveurs : 16 Go minimum

ECC (technologie de correction d'erreurs)
</code></pre></div></div>

<p>La mÃ©moire allouÃ©e Ã  lâ€™application 4D Server dÃ©pend de 4 facteurs :</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>la quantitÃ© de mÃ©moire totale sur votre machine,

la quantitÃ© de mÃ©moire disponible,

du systÃ¨me d'exploitation (32 ou 64 bits),

de la version de 4D Server utilisÃ©e (32 ou 64 bits).
</code></pre></div></div>

<p>Pour information, il nâ€™est pas possible dâ€™avoir un cache infÃ©rieur ou Ã©gal Ã  100 Mo. De toute faÃ§on le cache est trÃ¨s important, il faut donc rÃ©server une quantitÃ© de mÃ©moire suffisante (aprÃ¨s calcul de la mÃ©moire nÃ©cessaire pour les process, etc.) au cache de 4D.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>L'espace mÃ©moire rÃ©servÃ© au cache est sÃ©parÃ© de lâ€™espace mÃ©moire utilisÃ© par le serveur pour les process. Effectivement le fait d'augmenter la taille du cache diminue l'espace rÃ©servÃ© aux process.

La taille maximale varie en fonction du nombre d'utilisateurs connectÃ©s et du nombre de process par utilisateur. Cependant 1 Go environ est par dÃ©faut utilisÃ© par 4D (en dehors des process), notamment pour charger toutes les librairies systÃ¨mes.

La gestion du cache a Ã©tÃ© amÃ©liorÃ©e. En particulier, un nouveau mÃ©canisme effectue les opÃ©rations les plus consommatrices dans la mÃ©moire temporaire, ce qui permet dâ€™allÃ©ger le cache principal. La mÃ©moire temporaire a pour avantage de nâ€™Ãªtre utilisÃ©e quâ€™en cas de besoin et ne mobilise pas les ressources de la machine. Nous vous invitons Ã  calculer la mÃ©moire nÃ©cessaire au bon fonctionnement de 4D Server, et ensuite de la dÃ©duire de la mÃ©moire totale allouÃ©e par le systÃ¨me Ã  4D. Vous pourrez ainsi en dÃ©duire la taille de cache maximale que vous pouvez allouer. Une taille de cache excessive risque dâ€™ailleurs de diminuer les performances gÃ©nÃ©rales du systÃ¨me, voire de le rendre instable.

Pour connaÃ®tre le taux de rÃ©ussite il faut observer les variations de la mÃ©moire cache observÃ©e. Lorsque vous observez une diminution du cache utilisÃ©, cela signifie que 4D a eu besoin de supprimer des objets afin de libÃ©rer de la mÃ©moire pour certains objets du moteur de donnÃ©es. Si le cache est purgÃ© encore et encore, c'est une bonne analyse qui indique que le cache est trop petit. Dans ce cas, 4D a besoin de purger de maniÃ¨re rÃ©pÃ©tÃ©e un quart de son cache dans le but de libÃ©rer assez de place pour les objets du moteur de donnÃ©es.

La gestion du cache doit Ãªtre laissÃ© aux soins de 4D, seules la taille du cache et la frÃ©quence d'Ã©criture du cache sont importantes dÃ©sormais. Nous vous conseillons de ne pas utiliser la commande Â« ECRIRE CACHE Â» par exemple, il est prÃ©fÃ©rable d'utiliser l'option Â« Ã‰criture cache toutes les 20 secondes Â», qui spÃ©cifie les intervalles de sauvegarde des donnÃ©es, afin de contrÃ´ler l'Ã©criture du cache de donnÃ©es sur le disque. 4D utilise en interne un systÃ¨me intÃ©grÃ© de cache de donnÃ©es permettant d'accÃ©lÃ©rer les opÃ©rations d'EntrÃ©e/Sortie. Le fait que des modifications de donnÃ©es soient, par moment, prÃ©sentes dans le cache de donnÃ©es et pas sur le disque, est entiÃ¨rement transparent pour votre code. Par exemple, si vous appelez la commande Â« CHERCHER Â», le moteur de 4D va intÃ©grer les donnÃ©es prÃ©sentes dans le cache pour effectuer l'opÃ©ration.
</code></pre></div></div>

<p>Nous vous conseillons :</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>de ne pas cocher lâ€™option Â« Calcul du cache adaptatif Â» afin de fixer une taille de cache fixe ;

de dÃ©cocher, sous Mac, l'option Â« Maintenir le cache en mÃ©moire physique Â» ;

prÃ©voir suffisamment de mÃ©moire dans la machine pour le cache, la mÃ©moire moteur de 4D Server et le systÃ¨me d'exploitation lui-mÃªme ;

dÃ©ployer la version 64 bits de 4D Server (une application 32 bits ne peut pas utiliser plus de 4 Go de mÃ©moire, une application 64 bits dispose quant Ã  elle de 8 To d'espace adressable thÃ©orique !) ;

dÃ©terminer la valeur idÃ©ale du cache pour votre base en production en utilisant le composant Â« 4D_Info_Report Â» (http://taow.4d.com/Outil-4D-Info-Report/PS.1938271.fr.html).
</code></pre></div></div>

<p>(PrÃ©voir des slots de libre si le fichier de donnÃ©es est amenÃ© Ã  grossir rapidement pour rajouter de la mÃ©moire par la suite)</p>

<p>Le gestionnaire du cache de la base de donnÃ©es a Ã©tÃ© entiÃ¨rement rÃ©Ã©crit en 4D v16 et amÃ©liore ainsi lâ€™utilisation dâ€™un cache trÃ¨s important pour les ordinateurs modernes (avec 64 ou mÃªme 128 Go de cache) permettant de profiter des faibles prix des barrettes mÃ©moire et permettant ainsi de stocker une base de donnÃ©es de grande taille entiÃ¨rement en mÃ©moire. Il amÃ©liore Ã©galement les situations oÃ¹ le cache est de petite taille alors que le fichier de donnÃ©es est trÃ¨s volumineux grÃ¢ce Ã  une meilleure gestion des prioritÃ©s pour les objets de donnÃ©es Ã  contenir ou Ã  libÃ©rer du cache.
En consÃ©quence, la base de donnÃ©es sera plus rapide, permettant de gÃ©rer plus de donnÃ©es et plus dâ€™accÃ¨s utilisateurs simultanÃ©s.</p>

<p>Enfin, depuis la v16, le cache peut Ãªtre configurÃ© ou analysÃ© dynamiquement avec les commandes suivantes :</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>La commande Â« ECRIRE CACHE Â» accepte dÃ©sormais un paramÃ¨tre * pour vider le cache ou un nombre d'octets minimum de libÃ©ration du cache (uniquement pour effectuer des tests)

La commande Â« FIXER TAILLE CACHE Â» fixe dynamiquement la taille du cache de la base de donnÃ©es dans les versions 64 bits de 4D

La commande Â« Lire informations cache Â» rÃ©cupÃ¨re des informations relatives Ã  lâ€™utilisation du cache en 64 bits

La commande Â« Lire taille cache Â» retourne la taille courante du cache

Le sÃ©lecteur Â« PÃ©riodicitÃ© Ã©criture cache Â» de la commande Â« FIXER PARAMETRE BASE Â» permet de lire ou de fixer la pÃ©riodicitÃ© de l'Ã©criture du cache sur le disque
</code></pre></div></div>

<p>Dans les versions 64 bits de 4D, le cache des donnÃ©es de la base inclut un mÃ©canisme de gestion automatique des prioritÃ©s offrant un haut niveau dâ€™efficacitÃ© et de performance. Ce mÃ©canisme permet dâ€™optimiser la rotation des donnÃ©es dans le cache lorsque le programme a besoin de place : les donnÃ©es de plus faible prioritÃ© sont dÃ©chargÃ©es en premier, tandis que les donnÃ©es de prioritÃ© plus haute restent chargÃ©es.</p>

<p>Ce mÃ©canisme est entiÃ¨rement automatique et la plupart du temps, vous nâ€™aurez pas besoin de vous en prÃ©occuper. Cependant, pour des cas particuliers, il peut Ãªtre personnalisÃ© Ã  lâ€™aide dâ€™un ensemble de commandes dÃ©diÃ©es, vous permettant de changer la prioritÃ© des objets pour toute la session ou uniquement le process courant. A noter que ces commandes doivent Ãªtre utilisÃ©es avec prÃ©caution car elles peuvent affecter les performances de la base.</p>

<p>Le gestionnaire du cache sÃ©lectionne les donnÃ©es Ã  retirer du cache en cas de besoin Ã  lâ€™aide dâ€™un systÃ¨me de prioritÃ©. Les trois types dâ€™objets qui peuvent Ãªtre chargÃ©s dans le cache ont une prioritÃ© diffÃ©rente :</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tables : toutes les donnÃ©es standard des champs (numÃ©riques, dates...), Ã  l'exclusion des blobs (voir ci-dessous). PrioritÃ© par dÃ©faut : moyenne

blobs : toutes les donnÃ©es binaires des champs (textes, images, objets et blob) stockÃ©es dans le fichier de donnÃ©es. PrioritÃ© par dÃ©faut : faible

index : tous les index de champs simples, y compris les index de mots-clÃ©s et les index composites. Comme les index sont utilisÃ©s trÃ¨s frÃ©quemment, ils ont un statut spÃ©cial dans le cache. PrioritÃ© par dÃ©faut : Ã©levÃ©e
</code></pre></div></div>

<p>Les prioritÃ©s par dÃ©faut assurent gÃ©nÃ©ralement des performances optimales. Cependant, dans certains cas spÃ©cifiques, vous pouvez avoir besoin de personnaliser ces prioritÃ©s. Pour cela, vous disposez de deux ensembles de commandes 4D :</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Les commandes qui modifient les prioritÃ©s du cache pour l'ensemble de la session et tous les process : Â« FIXER PRIORITE CACHE TABLE Â», Â« FIXER PRIORITE CACHE INDEX Â» et Â« FIXER PRIORITE CACHE BLOBS Â». Ces commandes doivent Ãªtre appelÃ©es au dÃ©marrage de la base.

Les commandes qui modifient les prioritÃ©s du cache pour le process courant uniquement : Â« AJUSTER PRIORITE CACHE TABLE Â», Â« AJUSTER PRIORITE CACHE INDEX Â» et Â« AJUSTER PRIORITE CACHE BLOBS Â». Utilisez ces commandes si vous souhaitez changer temporairement la prioritÃ© des objets dans le cache afin d'amÃ©liorer les performances lors d'une opÃ©ration temporaire, puis revenir aux prioritÃ©s initiales. 
</code></pre></div></div>

<p>Ces commandes sont disponibles uniquement dans les contextes suivants :</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>4D version 64 bits

4D Server ou 4D en mode local
</code></pre></div></div>

<ol>
  <li>Disque dur</li>
</ol>

<p>RecommandÃ© :</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Un systÃ¨me de disques SSD ultra performant avec RAID 10 matÃ©riel (avec une carte contrÃ´leur RAID, de type PERC par exemple) pour stocker la base de donnÃ©es 4D

Un disque SSD de secours (si un des disques du systÃ¨me RAID tombe en panne)

Un disque de capacitÃ© suffisante pour le fichier d'historique courant et les jeux de sauvegardes (4BK et 4BL)

Restituer de temps en temps la derniÃ¨re sauvegarde (4BK) sur une autre machine et effectuer une vÃ©rification des donnÃ©es avec lâ€™outil intÃ©grÃ© (CSM) dans 4D. Cette action peut Ãªtre automatisÃ©e (nÃ©cessite un peu de dÃ©veloppement)
</code></pre></div></div>

<p>Attention : il est prÃ©fÃ©rable de sâ€™intÃ©resser aux vitesses dâ€™Ã©criture et de lecture avant dâ€™acheter un disque SSD.</p>

<p>Lâ€™idÃ©al serait de pouvoir y stocker le systÃ¨me, 4D Server et lâ€™intÃ©gralitÃ© de la base de donnÃ©es.</p>

<p>Ne nÃ©gligez pas lâ€™achat dâ€™un disque de secours (pour garantir la protection du systÃ¨me RAID) :</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Lorsquâ€™un disque est dÃ©fectueux : il nâ€™y a plus aucune protection tant que ce disque nâ€™est pas rÃ©parÃ©.

Lorsque deux disques sont dÃ©fectueux : le systÃ¨me sâ€™arrÃªte.
</code></pre></div></div>

<p>Cela signifie :</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>quâ€™il faut surveiller le disque, et ne pas faire une confiance aveugle au RAID,

que ce nâ€™est pas le jour oÃ¹ vous Ãªtes confrontÃ© Ã  un souci quâ€™il faut commander le disque de remplacement. En effet, le chef capable dâ€™acheter sera alors indisponible, voir le produit sera en rupture de stock chez le fournisseurâ€¦ Bref, vous vous retrouverez alors dans une situation oÃ¹ un second disque de la mÃªme marque, de la mÃªme sÃ©rie et probablement du mÃªme lot nâ€™aura quâ€™une envie : se mettre au repos comme son petit frÃ¨re !
</code></pre></div></div>

<p>Pour amÃ©liorer la tolÃ©rance aux pannes, la sÃ©curitÃ© et/ou les performances de lâ€™ensemble, la mise en place dâ€™un systÃ¨me RAID est un trÃ¨s bon choix :</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pour la base de donnÃ©es : le meilleur choix est le RAID 10 (sÃ©curitÃ© et performances),

pour les sauvegardes : le meilleur choix est le RAID 5 (prix et sÃ©curitÃ©).
</code></pre></div></div>

<p>Vous trouverez ci-dessous un comparatif des diffÃ©rents niveaux de RAID suivi des types de systÃ¨me RAID. Ce tableau nâ€™a pas Ã©tÃ© rÃ©alisÃ© par 4D mais je trouve quâ€™il rÃ©sume bien ce quâ€™il faut savoir sur le RAID.</p>

<ol>
  <li>Sauvegarde / OpÃ©rations de maintenance</li>
</ol>

<p>RecommandÃ© :</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Dans les propriÃ©tÃ©s de la base, onglet Â« PÃ©riodicitÃ© Â» :
            Activer la sauvegarde automatique de 4D (une fois par jour)

Dans les propriÃ©tÃ©s de la base, onglet Â« Configuration Â» :
            Cocher Â« Fichier de donnÃ©es Â»
            Cocher Â« Fichier de structure Â»
            Cliquer sur le bouton Â« Ajouter fichier Â» et sÃ©lectionner :
                        le fichier d'index des donnÃ©es Â« .4DIndx Â»
                        les 2 fichiers Â« .4DSyncData Â» et Â« .4DSyncHeader Â» (si vous utilisez le mÃ©canisme de rÃ©plication de 4D)
            Renseigner lâ€™emplacement des fichiers de sauvegarde et vÃ©rifier que lâ€™espace libre est suffisant pour stocker tous les fichiers de sauvegarde
            Cocher lâ€™option Â« Utiliser le fichier dâ€™historique Â»

Dans les propriÃ©tÃ©s de la base, onglet Â« Sauvegarde &amp; restitution Â» :
            Cocher lâ€™option Â« Conserver les X derniers fichiers de sauvegarde Â»
            Choisir lâ€™option Â« Effacer la sauvegarde la plus ancienne aprÃ¨s sauvegarde Â»
            Cocher Â« RÃ©essayer dans 60 secondes Â»
            DÃ©cocher l'option Â« Annuler l'opÃ©ration au bout de X tentatives Â»
            Cocher lâ€™option Â« Restituer la derniÃ¨re sauvegarde si la base est endommagÃ©e Â»
            Cocher lâ€™option Â« IntÃ©grer le dernier historique si la base est incomplÃ¨te Â»

VÃ©rifier et compacter le fichier de donnÃ©es rÃ©guliÃ¨rement (depuis la v13, il est possible de dÃ©tecter la fragmentation d'une table 4D et donc d'agir en consÃ©quence grÃ¢ce Ã  la commande Â« Lire fragmentation table Â»)

Fermer la fenÃªtre d'administration aprÃ¨s chaque utilisation
</code></pre></div></div>

<p>Depuis la version v15 R4, nous avons optimisÃ© de faÃ§on importante lâ€™algorithme de rÃ©indexation globale de la base de donnÃ©es. Tout le processus a Ã©tÃ© revu, et lâ€™opÃ©ration peut sâ€™effectuer dÃ©sormais jusquâ€™Ã  deux fois plus rapidement.</p>

<p>Note : Une rÃ©indexation globale est nÃ©cessaire, par exemple, aprÃ¨s une rÃ©paration de la base de donnÃ©es ou lorsque le fichier .4dindx a Ã©tÃ© supprimÃ©.</p>

<p>Comme chaque enregistrement de chaque table indexÃ©e doit Ãªtre chargÃ© en mÃ©moire durant lâ€™indexation, lâ€™optimisation a visÃ© Ã  minimiser les Ã©changes entre le cache et le disque (swaps). Lâ€™opÃ©ration est dÃ©sormais effectuÃ©e sÃ©quentiellement sur chaque table, ce qui rÃ©duit les besoins en chargement et en dÃ©chargement dâ€™enregistrements.
IdÃ©alement, si le cache Ã©tait assez grand pour contenir la totalitÃ© du fichier de donnÃ©es et des index, le nouvel algorithme de rÃ©indexation nâ€™apporterait aucune amÃ©lioration. Cependant, la mÃ©moire disponible sur le serveur nâ€™est gÃ©nÃ©ralement pas aussi grande. Si le cache est assez grand pour contenir au moins les donnÃ©es et les index de la table la plus volumineuse, alors le nouvel algorithme sera jusquâ€™Ã  deux fois plus rapide que le prÃ©cÃ©dent.</p>

<p>RÃ©aliser des sauvegardes rÃ©guliÃ¨res des donnÃ©es est important mais ne permet pas, en cas dâ€™incident, de rÃ©cupÃ©rer les donnÃ©es saisies depuis la derniÃ¨re sauvegarde. Pour rÃ©pondre Ã  ce besoin, 4D dispose dâ€™un outil particulier : le fichier dâ€™historique. Ce fichier permet dâ€™assurer la sÃ©curitÃ© permanente des donnÃ©es de la base.
En outre, 4D travaille en permanence avec un cache de donnÃ©es situÃ© en mÃ©moire. Toute modification effectuÃ©e sur les donnÃ©es de la base est stockÃ©e provisoirement dans le cache avant dâ€™Ãªtre Ã©crite sur le disque dur. Ce principe permet dâ€™accÃ©lÃ©rer le fonctionnement des applications ; en effet, les accÃ¨s mÃ©moire sont bien plus rapides que les accÃ¨s disque. Si un incident survient sur la base avant que les donnÃ©es stockÃ©es dans le cache aient pu Ãªtre Ã©crites sur le disque, vous devrez intÃ©grer le fichier dâ€™historique courant afin de rÃ©cupÃ©rer entiÃ¨rement la base.</p>

<p>Si vous travaillez en environnement virtuel, il est recommandÃ© dâ€™arrÃªter la base avant dâ€™effectuer un snapshot, pour Ãªtre certain que toutes les donnÃ©es stockÃ©es en mÃ©moire soient Ã©crites dans le fichier de donnÃ©es.</p>

<p>En plus de la sauvegarde et du fichier dâ€™historique de 4D, nous vous invitons Ã  planifier rÃ©guliÃ¨rement des opÃ©rations de maintenance en vÃ©rifiant et en compactant le fichier de donnÃ©es et dâ€™index.</p>

<p>Une fois votre stratÃ©gie de sauvegarde mise en place, nous vous invitons Ã  envisager le pire (incendie, vol) et donc dâ€™effectuer une copie hebdomadaire de la base sur un support inerte dans un autre endroit sÃ©curisÃ©.</p>

<p>Dans le cadre dâ€™applications critiques, il est Ã©galement possible de mettre en place un systÃ¨me de sauvegarde par miroir logique, permettant un redÃ©marrage instantanÃ© en cas dâ€™incident sur la base en exploitation. Les deux machines communiquent par le rÃ©seau, la machine en exploitation transmettant rÃ©guliÃ¨rement Ã  la machine miroir les Ã©volutions de la base par lâ€™intermÃ©diaire du fichier dâ€™historique.
De cette faÃ§on, en cas dâ€™incident sur la base en exploitation, vous pouvez repartir de la base miroir pour reprendre trÃ¨s rapidement lâ€™exploitation sans aucune perte de donnÃ©es.</p>

<p>Les principes mis en Å“uvre sont les suivants :</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>La base de donnÃ©es est installÃ©e sur le poste 4D Server principal (poste en exploitation) et une copie identique de la base est installÃ©e sur le poste 4D Server miroir.

Un test au dÃ©marrage de lâ€™application (par exemple la prÃ©sence dâ€™un fichier spÃ©cifique dans un sous-dossier de l'application 4D Server) permet de distinguer chaque version (en exploitation et en miroir) et donc dâ€™exÃ©cuter les opÃ©rations appropriÃ©es.

Sur le poste 4D Server en exploitation, le fichier dâ€™historique est segmentÃ© Ã  intervalle rÃ©gulier Ã  lâ€™aide de la commande Â« Nouveau fichier historique Â». Aucune sauvegarde nâ€™Ã©tant effectuÃ©e sur le serveur principal, la base de donnÃ©es est en permanence disponible en lecture/Ã©criture.

Chaque segment de fichier dâ€™historique est envoyÃ© sur le poste miroir, oÃ¹ il est intÃ©grÃ© Ã  la base miroir Ã  lâ€™aide de la commande Â« INTEGRER FICHIER HISTORIQUE Â».
</code></pre></div></div>

<p>La mise en place de ce systÃ¨me nÃ©cessite la programmation de code spÃ©cifique, notamment :</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>un minuteur sur le serveur principal pour la gestion des cycles dâ€™exÃ©cution de la commande Â« Nouveau fichier historique",

un systÃ¨me de transfert des segments de fichier dâ€™historique entre le poste en exploitation et le poste miroir (utilisation de 4D Internet Commands pour un transfert via ftp ou messagerie, Web Services, etc.),

un process sur le poste miroir destinÃ© Ã  superviser lâ€™arrivÃ©e de nouveaux segments de fichier dâ€™historique et Ã  les intÃ©grer via la commande Â« INTEGRER FICHIER HISTORIQUE Â»,

un systÃ¨me de communication et de gestion dâ€™erreurs entre le serveur principal et le serveur miroir.
</code></pre></div></div>

<p>Attention : La sauvegarde par miroir logique est incompatible avec les sauvegardes Â« standard Â» sur la base en exploitation car lâ€™emploi simultanÃ© de ces deux modes de sauvegarde entraÃ®ne la dÃ©synchronisation de la base en exploitation et de la base miroir. Par consÃ©quent, vous devez veiller Ã  ce quâ€™aucune sauvegarde, automatique ou manuelle, ne soit effectuÃ©e sur la base en exploitation. En revanche, il est possible de sauvegarder la base miroir.</p>

<p>Depuis la version v14, il est possible dâ€™activer le fichier dâ€™historique courant sur le poste miroir. Vous pouvez ainsi mettre en place un Â« miroir de miroir Â», ou des serveurs miroirs en sÃ©rie. Cette possibilitÃ© sâ€™appuie sur la commande Â« INTEGRER FICHIER HISTORIQUE MIROIR Â».</p>

<ol>
  <li>RÃ©seau</li>
</ol>

<p>RecommandÃ© :</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Utiliser l'ancienne couche rÃ©seau jusqu'Ã  la version v15 R5

Utiliser la nouvelle couche rÃ©seau Ã  partir de la version 16.2 publique
</code></pre></div></div>

<p>Attention : lâ€™ancienne couche rÃ©seau nâ€™est pas disponible dans les versions 64 bits de 4D Developer (Windows et Mac) et dans la version 64 bits de 4D Server (Mac uniquement).</p>

<p>Il est trÃ¨s important pour 4D Server dâ€™avoir en permanence suffisamment de bande passante pour communiquer avec ses postes distants. Si vous mutualisez la bande passante, il faudra en rÃ©server une partie pour 4D Server.
En effet, lorsque la bande passante vient Ã  manquer, certains paquets sont perdus et cela provoque inÃ©vitablement des erreurs cÃ´tÃ© Serveur. Si trop dâ€™erreurs rÃ©seau surviennent au mÃªme moment ou de faÃ§on trop frÃ©quence, vous dÃ©stabilisez 4D Server.</p>

<p>Sachez Ã©galement que, si vous utilisez le serveur Web de 4D et que vous dÃ©sirez sÃ©parer le trafic pour des raisons de sÃ©curitÃ© et/ou de performances, il est possible de dÃ©dier une carte rÃ©seau aux utilisateurs de 4D Distant et une autre aux requÃªtes Web, SOAP ou REST.</p>

<ol>
  <li>Web</li>
</ol>

<p>RecommandÃ© :</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>utiliser une version 64 bits de 4D

utiliser 4D Server ou 4D en mode local (le mode prÃ©emptif n'est pas pris en charge par 4D en mode distant)

dÃ©ployer une application 4D compilÃ©e ou exÃ©cutable

avoir le maximum de mÃ©thodes bases et mÃ©thodes projets relatives au Web confirmÃ©es thread-safe par 4D Compiler

dans les propriÃ©tÃ©s de votre base :

            cocher l'option "Utiliser des process prÃ©emptifs" pour activer le mode prÃ©emptif,

            cocher l'option "utiliser le cache Web de 4D" et fixer une taille de cache de 524 288 Ko,

            fixer Ã  8 heures le dÃ©lai de conservation des process inactifs et cocher la case "gestion automatique des sessions" pour que les utilisateurs Web puissent rÃ©utiliser le mÃªme contexte durant la journÃ©e (si vous ne les gÃ©rez pas par programmation),

            cocher l'option "utiliser les connexions persistantes".
</code></pre></div></div>

<p>Depuis la version v16, le serveur Web intÃ©grÃ© de 4D (en 64 bits uniquement) pour Windows et pour Mac OS X permet de tirer pleinement parti du multi-cÅ“urs en utilisant des process Web prÃ©emptifs dans les applications compilÃ©es. La plupart des commandes de 4D liÃ©es au Web, les mÃ©thodes et les URL de la base de donnÃ©es sont thread-safe et peuvent Ãªtre utilisÃ©es en mode prÃ©emptif. Vous pouvez configurer votre code liÃ© au Web, y compris les balises HTML 4D et les mÃ©thodes base Web, afin quâ€™il sâ€™exÃ©cute simultanÃ©ment sur le plus grand nombre de cÅ“urs possibles.</p>

<ol>
  <li>Machine physique ou virtuelle</li>
</ol>

<p>RecommandÃ© : machine physique</p>

<p>MÃªme si 4D fonctionne en environnement virtuel et est donc Ã©ligible en terme dâ€™exploitabilitÃ©, cÃ´tÃ© performances notre expÃ©rience nous montre quâ€™une machine physique offre de meilleures performances dans le temps Ã  ressources Ã©quivalentes.</p>

<p>Sâ€™il ne vous est pas imposÃ© de virtualiser le serveur 4D en production, nous vous conseillons dans un premier temps de le dÃ©ployer sur une machine physique. Puis dans un second temps, de programmer des tests poussÃ©s en environnement virtuel. Vous aurez ainsi lâ€™avantage de pouvoir comparer les 2 solutions.</p>

<p>Toutefois, si lâ€™on peut trouver un avantage Ã  la virtualisation câ€™est la souplesse dâ€™allocation des ressources (CPU, mÃ©moire notamment). Il est possible dâ€™allouer des ressources supplÃ©mentaires par la suite, voir mÃªme dâ€™allouer des ressources en temps rÃ©el, en fonction de lâ€™activitÃ© de la machine. Nous avons dâ€™ailleurs un certain nombre de clients qui travaillent avec des environnements virtualisÃ©s, de plus en plus dâ€™ailleurs. Nous avons mÃªme des clients qui dÃ©ploient des serveurs TSE virtualisÃ©s sur des serveurs lames.</p>

<p>Nous nâ€™avons cependant pas de documents officiels certifiant le fonctionnement de 4D en environnement virtuel ou privilÃ©giant une solution plutÃ´t quâ€™une autre.</p>

<p>Nous prÃ©conisons uniquement de sâ€™assurer que les performances de la machine soient suffisantes en termes de ressources (mÃ©moire, processeur, etc.) ou que le systÃ¨me dâ€™exploitation virtualisÃ© soit certifiÃ© avec la version de 4D installÃ©e.
De maniÃ¨re gÃ©nÃ©rale les ressources CPU et RAM doivent Ãªtre un peu plus importantes en environnement virtualisÃ© par rapport Ã  une solution non virtualisÃ©e.</p>

<p>De plus les performances observÃ©es dÃ©pendent grandement du paramÃ©trage de la machine virtuelle (CPU, mÃ©moire, etc.) mais aussi du disque dur et de la carte rÃ©seau (caractÃ©ristiques, est-elle partagÃ©e, dÃ©diÃ©e, correctement configurÃ©e, etc.), de la solution utilisÃ©e, de la version de la solution et du systÃ¨me sur lequel est installÃ© la solution. Pour cette partie je vous invite Ã  consulter les sites et forums des Ã©diteurs de solutions virtualisÃ©es ainsi que les Ã©tudes comparatives.</p>

<p>Remarque : Si vous travaillez en environnement virtuel, il est recommandÃ© dâ€™arrÃªter la base avant dâ€™effectuer un snapshot, pour Ãªtre certain que toutes les donnÃ©es stockÃ©es en mÃ©moire soient Ã©crites dans le fichier de donnÃ©es.</p>

<ol>
  <li>Marque / ModÃ¨le de machine</li>
</ol>

<p>Nous nâ€™avons pas de prÃ©conisations particuliÃ¨res, il faut cependant regarder en dÃ©tails le matÃ©riel qui compose la machine avant de lâ€™acheter afin de sâ€™assurer que les composants soient compatibles entre eux et que ses caractÃ©ristiques correspondent Ã  vos attentes et aux prÃ©conisations ci-dessus.</p>
<ol>
  <li>Tests / Recette / DÃ©ploiement</li>
</ol>

<p>Ne dÃ©ployez pas votre base de donnÃ©es sans lâ€™avoir testÃ© au prÃ©alable dans son futur environnement ou dans un environnement similaire (matÃ©riel, version de 4D identique, etc.) et surtout dans ses futures conditions dâ€™utilisation (avec le mÃªme nombre dâ€™utilisateurs simultanÃ©s en utilisant des scÃ©narios de tests Utilisateur).
Stresser sa base de donnÃ©es pour en connaÃ®tre les limites, non dÃ©tectables par lâ€™Ã©quipe de dÃ©veloppement, vous Ã©pargnera bien des soucis en Production et permettra dâ€™optimiser les fonctionnalitÃ©s les plus utilisÃ©es.</p>

<p>Les tests et la recette sont les clÃ©s dâ€™un dÃ©ploiement rÃ©ussi !</p>

<ol>
  <li>SÃ©curitÃ©</li>
</ol>

<p>Source : https://blog.4d.com/security-data-protection/</p>

<p>La sÃ©curitÃ© est un sujet important et fondamental pour une base de donnÃ©es ou un systÃ¨me de solution entreprise. Ce chapitre propose un aperÃ§u de la faÃ§on dont 4D protÃ¨ge vos donnÃ©es. En fait, la sÃ©curitÃ© est la protection des donnÃ©es. Et la protection des donnÃ©es est une vaste zone. Les donnÃ©es doivent Ãªtre protÃ©gÃ©es pour les accÃ¨s indÃ©sirables, mais aussi pour la perte. Ceci est un fait important, car la plupart des utilisateurs ne pensent quâ€™Ã  la protection des utilisateurs non autorisÃ©s, pas de protection pour des Ã©vÃ©nements tels que panne de courant, disque dur endommagÃ©, les modifications accidentelles de donnÃ©es et ainsi de suite.</p>

<p>SÃ©curitÃ© et protection des donnÃ©es est une zone trÃ¨s large : cela commence par lâ€™authentification de lâ€™utilisateur, passe par lâ€™accÃ¨s externe (comme le Web ou le SQL), lâ€™exÃ©cution de code indÃ©sirable (injection SQL, attaques dâ€™inspection du script), puis les mises Ã  jour de sÃ©curitÃ©, de sauvegarde et plus encore.</p>

<p>4D Server</p>

<p>4D Server est un systÃ¨me intÃ©grÃ© de dÃ©veloppement client / serveur, optimisÃ© pour crÃ©er des applications dâ€™entreprise robustes avec un systÃ¨me de base de donnÃ©es intÃ©grÃ©e. Bien que 4D peut envoyer des donnÃ©es (avec des normes telles que HTTP, SOAP, ODBC ou OCI) ou peut Ãªtre accessible Ã  partir de lâ€™extÃ©rieur (avec HTTP, SOAP, ODBC / SQL), lâ€™utilisation principale est basÃ©e sur le langage de dÃ©veloppement interne Â« 4D Â», en utilisant un protocole rÃ©seau interne et propriÃ©taire pour communiquer entre le client et le serveur.</p>

<p>La communication rÃ©seau prend en charge le cryptage TLS 1.2, soit Ã  lâ€™aide dâ€™une clÃ© prÃ©dÃ©finie (pas de certificat SSL requis), soit avec un fichier contenant une clÃ©.</p>

<p>La liaison Ã©troite entre le langage de dÃ©veloppement et la communication rÃ©seau permet une construction de haut niveau dans le concept de protection, en Ã©vitant les scÃ©narios dâ€™attaque typiques tels que lâ€™injection SQL ou des attaques Â« buffer overflow Â».</p>

<p>Le langage 4D est un langage puissant et mature, parfaitement conÃ§u pour construire des systÃ¨mes dâ€™applications dâ€™entreprise. Il propose plus de 1 500 commandes, couvrant les opÃ©rations de base de donnÃ©es (tris, requÃªtes, crÃ©ations, transactions et ainsi de suite), lâ€™impression, la communication avec dâ€™autres appareils ou ordinateurs, la gestion des documents, une fenÃªtre ou une interface utilisateur, et bien plus encore. Jeter un coup dâ€™Å“il au manuel du langage 4D pour plus de dÃ©tails.</p>

<p>Le langage lui-mÃªme est segmentÃ©, mÃªme en mode interprÃ©tÃ© (dÃ©veloppement ou prototypage), il nâ€™est jamais exÃ©cutÃ© comme une Ã©valuation de texte. En mode production, le langage est compilÃ© et intÃ¨gre un contrÃ´le automatique de plage de version contre les attaques de type Â« buffer overflow Â».</p>

<p>Serveur Web</p>

<p>4D dispose de son propre serveur HTTP, un puissant serveur multithread pour les contenus statiques et dynamiques. Lâ€™intÃ©gration Ã©troite a un impact considÃ©rable sur la sÃ©curitÃ© accrue.</p>

<p>Sans compter une meilleure sÃ©curitÃ© du code (voir ci-dessous), ce concept supprime le problÃ¨me de mise Ã  jour typique oubliÃ©. Comme tout est intÃ©grÃ©, il nâ€™y a quâ€™un seul logiciel Ã  mettre Ã  jour. Les solutions habituelles nÃ©cessitent une Ã©norme quantitÃ© de logiciels Ã  maintenir Ã  jour : PHP, OpenSSL, Apache, NodeJS, etc. Tous ont besoin de mises Ã  jour rÃ©guliÃ¨res et il est commun que certaines parties restent non patchÃ©es pendant longtemps, en particulier si elles sont utilisÃ©es comme solution de service, sans une Ã©quipe informatique spÃ©cialisÃ©e.</p>

<p>Les requÃªtes web dÃ©clenchent du code 4D, qui rÃ©pondent Ã  la demande au niveau applicatif, pas seulement au niveau de la base de donnÃ©es. Lâ€™intÃ©gration Ã©troite permet de contrÃ´ler toutes les requÃªtes, utilisant la construction dâ€™autorisations et dâ€™implÃ©mentations sur mesure, bien sÃ»r cryptÃ© TLS.</p>

<p>Le serveur intÃ©grÃ© HTTP permet Ã©galement des justifications de contrÃ´le fin, par exemple pour un serveur REST.</p>

<p>La version 4D v16 R6 prend dÃ©sormais en charge Perfect Forward Secrecy (PFS). Cela vous donne le niveau de sÃ©curitÃ© le plus Ã©levÃ© pour vos communications, par dÃ©faut ! Au delÃ  de la protection quâ€™il offre, le soutien de PFS augmente Ã©galement les rÃ©sultats des tests de vÃ©rification SSL, ce qui est excellent pour nos clients. En particulier, ceux qui travaillent avec des informations sensibles.</p>

<p>Le niveau de sÃ©curitÃ© par dÃ©faut du serveur Web de 4D a Ã©tÃ© augmentÃ© pour Ãªtre conforme Ã  certaines fonctions de sÃ©curitÃ© rÃ©seau (SÃ©curitÃ© App Transport (ATS) sur iOS, par exemple), et permet dâ€™obtenir de meilleurs rÃ©sultats lors des tests de vÃ©rification de sÃ©curitÃ© Web (par exemple: SSL Labs).</p>

<p>Pour ce faire, nous avons :</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>activÃ© Â« Perfect Forward Secrecy Â», et

dÃ©sactivÃ© l'algorithme RC4 de la liste de chiffrement.
</code></pre></div></div>

<p>Par consÃ©quent, le serveur Web 4D obtient un Â« A Â» dans le classement de SSL Labs, sans quâ€™aucune action ne soit nÃ©cessaire !</p>

<p>Perfect Forward Secrecy (PFS) est un algorithme dâ€™Ã©change de clÃ©s. Il utilise les algorithmes Diffie-Hellman (DH) pour gÃ©nÃ©rer des clÃ©s de session de telle sorte que seuls les deux parties impliquÃ©es dans la communication peuvent les obtenir.</p>

<p>4D active automatiquement PFS lorsque TLS est activÃ© sur le serveur. Pour cela, 4D gÃ©nÃ¨re un fichier
Â« dhparams.pem Â» - si il nâ€™existe pas dÃ©jÃ  - qui contient la clÃ© privÃ©e de votre serveur DH. Si vous utilisez la liste de chiffrement standard de 4D, PFS est prÃªt Ã  lâ€™emploi. Si vous prÃ©fÃ©rez utiliser une liste de chiffrement personnalisÃ©, vÃ©rifiez quâ€™il contient des entrÃ©es avec des algorithmes de ECDH ou DH.</p>

<p>Pour savoir si PFS est activÃ© sur votre serveur Web, exÃ©cutez la commande Â« WEB Get server info Â» avec le nouvel attribut Â« perfectForwardSecrecy Â». Cela permet de vÃ©rifier si toutes les conditions nÃ©cessaires pour utiliser PFS sont remplies :</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>TLS est activÃ©

La liste de chiffrement contient au moins un algorithme ECDH ou DH

Le fichier Â« Dhparams.pem Â» est prÃ©sent et valide

Tous les certificats SSL / TLS sont prÃ©sents
</code></pre></div></div>

<p>Lâ€™algorithme RC4 a connu des problÃ¨mes de sÃ©curitÃ© et est maintenant dÃ©prÃ©ciÃ© dans le serveur Web de 4D. Tous les chiffrements RC4 ont Ã©tÃ© retirÃ©s de la liste de chiffrement par dÃ©faut et le modÃ¨le Â« !RC4 Â» a Ã©tÃ© ajoutÃ© Ã  la liste de chiffrement pour lâ€™interdire explicitement.</p>

<p>Serveur SOAP</p>

<p>Similaire au serveur HTTP, un serveur SOAP est intÃ©grÃ©, ce qui permet un contrÃ´le dÃ©taillÃ© dâ€™accÃ¨s, basÃ© sur des objets mÃ©tiers (pas seulement au niveau de la base de donnÃ©es).</p>

<p>Serveur SQL</p>

<p>Alors que lâ€™accÃ¨s aux donnÃ©es pour un client 4D utilise par dÃ©faut un protocole propriÃ©taire, lâ€™accÃ¨s SQL (natif ou via ODBC) est aussi bien pris en charge. En outre, il existe des drivers PDO Open Source disponibles (PHP Data Objects). Lâ€™accÃ¨s SQL au niveau base de donnÃ©es peut Ãªtre contrÃ´lÃ© par un systÃ¨me de mot de passe, des schÃ©mas SQL ou Ã  lâ€™aide de vues SQL.</p>

<p>SystÃ¨me de mot de passe 4D</p>

<p>Le systÃ¨me propriÃ©taire dâ€™autorisation dâ€™accÃ¨s utilisateur de 4D peut Ãªtre remplacÃ© par des systÃ¨mes tiers. 4D prend en charge lâ€™utilisation directe de Microsoft Active Directory et LDAP, ainsi que des systÃ¨mes entiÃ¨rement personnalisÃ©s.</p>

<p>MÃ©canisme de mise Ã  jour logicielle</p>

<p>Les logiciels modernes sont une combinaison complexe de logiciels, serveur de base de donnÃ©es, middleware, serveur dâ€™applications, serveur web et bien plus encore. Il est facile dâ€™oublier de garder toutes les piÃ¨ces Ã  jour, comme une DLL dâ€™OpenSSL par exemple. 4D rÃ©duit ce problÃ¨me Ã  bien des Ã©gards, non seulement en aidant lâ€™administrateur dans sa vie quotidienne, mais aussi en rÃ©duisant le risque par la conception.</p>

<p>Tout Ã©tant intÃ©grÃ© en une seule solution, il nâ€™y a quâ€™un seul dossier Ã  remplacer. Tout est installÃ© dans un seul dossier, il pourrait mÃªme Ãªtre remplacÃ© par un processus de glisser-dÃ©poser. Faire simple Ã©vite le syndrome Â« je le ferai plus tard Â». Avec un seul remplacer, toutes les parties de lâ€™application mÃ©tier sont mises Ã  jour en une seule Ã©tape, rien ne peut manquer.</p>

<p>Le serveur peut Ãªtre mis Ã  jour automatiquement. Le processus de mise Ã  jour est contrÃ´lÃ© et forcÃ© par 4D lui-mÃªme, il peut donc Ãªtre pilotÃ© par le dÃ©veloppeur de la solution.</p>

<p>SystÃ¨me de sauvegarde et de journalisation</p>

<p>4D fournit par dÃ©faut un systÃ¨me de journalisation transactionnelle. Chaque opÃ©ration de modification de donnÃ©es est enregistrÃ©e et peut Ãªtre annulÃ©e. En cas dâ€™urgence, le travail de la journÃ©e peut Ãªtre restaurÃ©e - rien nâ€™est perdu. Dans le cas dâ€™une interruption, la base de donnÃ©es est automatiquement vÃ©rifiÃ©e lors du redÃ©marrage et les opÃ©rations manquantes (conservÃ©es en mÃ©moire mais non stockÃ©es sur le disque encore) sont restaurÃ©es, afin dâ€™avoir une base de donnÃ©es contenant toutes les informations. MÃªme dans le cas dâ€™une corruption totale des donnÃ©es (endommagement du disque, etc.), le fichier de donnÃ©es est automatiquement restaurÃ© Ã  partir de la derniÃ¨re sauvegarde complÃ¨te et le fichier dâ€™historique (contenant le travail quotidien) est intÃ©grÃ©.</p>

<p>Le journal des transactions peut Ã©galement Ãªtre utile en cas de suppression accidentelle (ou volontaire dâ€™enregistrements) et, Ã  la fois pour la rÃ©cupÃ©ration lÃ©gale des donnÃ©es.</p>

<p>La sauvegarde standard fait partie du produit 4D, aucune licence supplÃ©mentaire nâ€™est nÃ©cessaire, seul un disque dur additionnel est vivement conseillÃ© (pour se protÃ©ger des pannes de disque).</p>

<p>Dans les environnements 24/7, 4D prend en charge lâ€™utilisation de systÃ¨mes miroirs montÃ©s en cascade et/ou en Ã©toile. Une production, un miroir et un miroir secondaire permettent dâ€™assurer un service 24 heures sur 24. Un systÃ¨me de miroir supplÃ©mentaire pourrait Ãªtre exÃ©cutÃ© dans une autre ville ou le Cloud pour protÃ©ger les donnÃ©es, mÃªme en cas de catastrophes extrÃªmes.</p>

<p>ParallÃ¨lement Ã  cela, le systÃ¨me de journalisation transactionnelle de 4D prend en charge les snapshots des machines virtuelles (comme Volume Shadow Copy Service de VMWare vSphere (Hyperviseur ESXi, pris en charge Ã  partir de la version 16 R2).</p>

<p>Protection additionnelle</p>

<p>Tous les concepts de protection standard, tels que la protection de la salle Serveur ou lâ€™utilisation de disques durs cryptÃ©s (solutions matÃ©rielles avec SSD chiffrÃ© ou utilisation de logiciel cryptÃ© comme Bitlocker) sont bien sÃ»r recommandÃ©s.</p>

<p>Voici Ã©galement un lien vers notre guide sur la sÃ©curitÃ© : https://blog.4d.com/4d-security-guide/</p>
<ol>
  <li>Surveillance du serveur</li>
</ol>

<p>Vous pouvez utiliser le composant Â« 4D_Info_Report Â» pour collecter un maximum dâ€™informations :</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sur l'environnement systÃ¨me, matÃ©riel, 4D

sur la base : structure, donnÃ©es, triggers, index, rÃ©glages personnalisÃ©s utilisÃ©s, etc.

en temps rÃ©el : mÃ©moire, cache, utilisateurs connectÃ©s, process, etc.
</code></pre></div></div>

<p>Ce composant peut Ãªtre utilisÃ© en Production sans problÃ¨me : lâ€™impact sur les performances de lâ€™application monitorÃ©e est nÃ©gligeable.</p>

<p>Vous pouvez Ã©galement utiliser lâ€™onglet Â« Moniteur Â» de la fenÃªtre dâ€™administration de 4D Server  pour afficher des informations dynamiques relatives Ã  lâ€™exploitation de la base de donnÃ©es ainsi que des informations sur le systÃ¨me et lâ€™application 4D Server.</p>

<p>La zone graphique permet de visualiser lâ€™Ã©volution en temps rÃ©el de plusieurs paramÃ¨tres :</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>le taux dâ€™utilisation des processeurs,

le trafic rÃ©seau,

l'Ã©tat de la mÃ©moire.
</code></pre></div></div>

<p>Ces informations peuvent Ãªtre obtenues par programmation grÃ¢ce Ã  la commande Â« LIRE APERCU ACTIVITE Â». Cette commande permet dâ€™obtenir un instantanÃ© des n opÃ©rations les plus coÃ»teuses en temps et/ou les plus frÃ©quentes en cours dâ€™exÃ©cution telles que lâ€™Ã©criture du cache ou lâ€™exÃ©cution de formules.</p>

<p>Par dÃ©faut, la commande Â« LIRE APERCU ACTIVITE Â» traite des opÃ©rations effectuÃ©es en local (avec 4D monoposte, 4D Server ou 4D en mode distant). Avec 4D en mode distant cependant, vous pouvez Ã©galement obtenir lâ€™aperÃ§u des opÃ©rations effectuÃ©es sur le serveur : il suffit pour cela de passer lâ€™Ã©toile (*) en dernier paramÃ¨tre. Dans ce cas, les donnÃ©es du serveur seront rÃ©cupÃ©rÃ©es localement. Le paramÃ¨tre * est ignorÃ© lorsque la commande est exÃ©cutÃ©e sur 4D Server ou 4D monoposte.</p>

<p>Une nouvelle commande est Ã©galement apparue en version 4D v16 R4 (modifiÃ©e en v16 R5) : Â« Lire activite process Â». Elle retourne une vue instantanÃ©e des sessions des utilisateurs connectÃ©s  et/ou des process exÃ©cutÃ©s Ã  un instant prÃ©cis, y compris les process internes qui nâ€™Ã©taient pas accessibles avec la commande Â« INFORMATIONS PROCESS Â».</p>
:ET